<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Website Karang Taruna Jangkar Muda - Secure Version</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
        }

        /* Navigation */
        nav {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
        }

        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: #ffd700;
        }

        .admin-btn {
            background: #ffd700;
            color: #1e3c72;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: transform 0.2s;
        }

        .admin-btn:hover {
            transform: scale(1.05);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
            padding: 80px 20px;
        }

        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
        }

        .hero p {
            font-size: 1.3rem;
            margin-bottom: 2rem;
        }

        /* Container */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 60px 20px;
        }

        /* Sections */
        section {
            margin-bottom: 60px;
        }

        h2 {
            color: #1e3c72;
            font-size: 2rem;
            margin-bottom: 30px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
        }

        /* Profile Section */
        .profile-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }

        .profile-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .profile-card h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .profile-card p {
            color: #666;
            line-height: 1.8;
        }

        /* Gallery */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .gallery-item {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
        }

        .gallery-item img, .gallery-item video {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .gallery-info {
            padding: 15px;
        }

        .gallery-info h4 {
            color: #333;
            margin-bottom: 8px;
        }

        .gallery-info p {
            color: #666;
            font-size: 0.9rem;
        }

        .file-preview {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .file-icon {
            font-size: 60px;
            margin-bottom: 10px;
        }

        /* News Section */
        .news-list {
            display: grid;
            gap: 20px;
        }

        .news-item {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .news-item h3 {
            color: #1e3c72;
            margin-bottom: 10px;
        }

        .news-date {
            color: #999;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        /* Structure Section */
        .structure-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .member-card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .member-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 48px;
        }

        .member-card h4 {
            color: #1e3c72;
            margin-bottom: 5px;
        }

        .member-position {
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
        }

        /* Footer */
        footer {
            background: #1e3c72;
            color: white;
            text-align: center;
            padding: 30px 20px;
            margin-top: 60px;
        }

        /* Modal Admin */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 15px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .close-btn {
            position: absolute;
            top: 15px;
            right: 20px;
            font-size: 30px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 14px;
            margin: 5px;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #e0e0e0;
        }

        .tab {
            padding: 12px 24px;
            background: transparent;
            border: none;
            cursor: pointer;
            font-size: 16px;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
        }

        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .admin-logged {
            text-align: center;
            padding: 20px;
            background: #d4edda;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .session-info {
            background: #e7f3ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 0.9rem;
        }

        .security-badge {
            display: inline-block;
            padding: 5px 10px;
            background: #28a745;
            color: white;
            border-radius: 5px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        .attempt-counter {
            background: #fff3cd;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }
            
            .nav-links {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav>
        <div class="nav-container">
            <div class="logo">Jangkar Muda <span class="security-badge">üîí Secure</span></div>
            <ul class="nav-links">
                <li><a href="#beranda">Beranda</a></li>
                <li><a href="#profil">Profil</a></li>
                <li><a href="#berita">Berita</a></li>
                <li><a href="#galeri">Galeri</a></li>
                <li><a href="#struktur">Struktur</a></li>
                <li><a href="#kontak">Kontak</a></li>
            </ul>
            <button class="admin-btn" onclick="openAdmin()">üîê Admin</button>
        </div>
    </nav>

    <!-- Hero -->
    <div class="hero" id="beranda">
        <h1 id="heroTitle">Salam Sejahtera</h1>
        <p id="heroSubtitle">Membangun Lingkungan yang maju, mandiri, dan sejahtera</p>
    </div>

    <!-- Main Content -->
    <div class="container">
        <!-- Profil Section -->
        <section id="profil">
            <h2>üìã Profil Organisasi</h2>
            <div class="profile-grid">
                <div class="profile-card">
                    <h3>Visi</h3>
                    <p id="visiContent">Menjadi Lingkungan yang maju, sejahtera, dan mandiri dengan baik.</p>
                </div>
                <div class="profile-card">
                    <h3>Misi</h3>
                    <p id="misiContent">
                        1. Meningkatkan kualitas pelayanan publik<br>
                        2. Mengembangkan potensi ekonomi Lingkungan<br>
                        3. Memberdayakan masyarakat
                    </p>
                </div>
                <div class="profile-card">
                    <h3>Sejarah</h3>
                    <p id="sejarahContent">Karang Taruna ini didirikan pada tahun xxxx dengan tujuan untuk melayani dan memajukan kesejahteraan Lingkungan.</p>
                </div>
            </div>
        </section>

        <!-- Berita Section -->
        <section id="berita">
            <h2>üì∞ Berita & Pengumuman</h2>
            <div class="news-list" id="newsList">
                <div class="news-item">
                    <h3>Selamat Datang di Website Resmi</h3>
                    <div class="news-date">1 Januari 2026</div>
                    <p>Website ini merupakan media informasi resmi untuk memberikan pelayanan terbaik kepada masyarakat.</p>
                </div>
            </div>
        </section>

        <!-- Galeri Section -->
        <section id="galeri">
            <h2>üì∏ Galeri Foto & Video</h2>
            <div class="gallery-grid" id="galleryGrid">
                <div class="gallery-item">
                    <div class="file-preview">
                        <div class="file-icon">üì∑</div>
                        <div>Belum ada foto</div>
                    </div>
                    <div class="gallery-info">
                        <h4>Upload foto kegiatan</h4>
                        <p>Silakan login sebagai admin untuk menambahkan galeri</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Struktur Section -->
        <section id="struktur">
            <h2>üë• Struktur Organisasi</h2>
            <div class="structure-grid" id="structureGrid">
                <div class="member-card">
                    <div class="member-photo">üë§</div>
                    <h4>Nama Pejabat</h4>
                    <div class="member-position">Kepala Desa</div>
                    <p>Login sebagai admin untuk menambahkan data</p>
                </div>
            </div>
        </section>

        <!-- Kontak Section -->
        <section id="kontak">
            <h2>üìû Kontak</h2>
            <div class="profile-grid">
                <div class="profile-card">
                    <h3>Alamat</h3>
                    <p id="alamatContent">JManggisan 1/2, Plosokandang, Kedungwaru, Tulungagung, Jawa timur</p>
                </div>
                <div class="profile-card">
                    <h3>Telepon</h3>
                    <p id="teleponContent">021-12345678</p>
                </div>
                <div class="profile-card">
                    <h3>Email</h3>
                    <p id="emailContent">Jangkarmuda26@email.com</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer>
        <p>&copy; 2026 Jangkar Muda. Hak Cipta Dilindungi.</p>
        <p style="font-size: 0.9rem; margin-top: 10px;">üîí Website Aman dengan Enkripsi Data</p>
    </footer>

    <!-- Admin Modal -->
    <div class="modal" id="adminModal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeAdmin()">&times;</span>
            
            <div id="loginSection">
                <h2>üîê Login Admin - Secure Access</h2>
                <div id="alertBox"></div>
                <div id="loginAttemptWarning"></div>
                <div class="login-form">
                    <div class="form-group">
                        <label>User Admin:</label>
                        <input type="email" id="adminEmail" placeholder="admin@email.com" autocomplete="username">
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="adminPassword" placeholder="Masukkan password" autocomplete="current-password">
                    </div>
                    <button class="btn" onclick="loginAdmin()" id="loginBtn">üîì Login</button>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 8px; font-size: 0.9rem;">
                        <strong>üõ°Ô∏è Fitur Keamanan Aktif:</strong><br>
                        ‚úì Password terenkripsi (SHA-256)<br>
                        ‚úì Auto-logout setelah 30 menit<br>
                        ‚úì Pembatasan login attempt<br>
                        ‚úì Session monitoring<br>
                        ‚úì Data terenkripsi di browser
                    </div>
                </div>
            </div>

            <div id="adminPanel" style="display: none;">
                <div class="admin-logged">
                    <h3>‚úÖ Selamat datang, Admin!</h3>
                    <p>Email: <strong id="loggedEmail"></strong></p>
                    <div class="session-info" id="sessionInfo"></div>
                    <button class="btn btn-danger btn-small" onclick="logoutAdmin()">üö™ Logout</button>
                </div>

                <div class="tabs">
                    <button class="tab active" onclick="switchAdminTab('profil')">üìã Profil</button>
                    <button class="tab" onclick="switchAdminTab('berita')">üì∞ Berita</button>
                    <button class="tab" onclick="switchAdminTab('galeri')">üì∏ Galeri</button>
                    <button class="tab" onclick="switchAdminTab('struktur')">üë• Struktur</button>
                    <button class="tab" onclick="switchAdminTab('kontak')">üìû Kontak</button>
                    <button class="tab" onclick="switchAdminTab('security')">üîí Keamanan</button>
                </div>

                <!-- Tab Profil -->
                <div id="adminProfilTab" class="tab-content active">
                    <h3>Edit Profil Website</h3>
                    <div class="form-group">
                        <label>Judul Website:</label>
                        <input type="text" id="editHeroTitle">
                    </div>
                    <div class="form-group">
                        <label>Subtitle:</label>
                        <input type="text" id="editHeroSubtitle">
                    </div>
                    <div class="form-group">
                        <label>Visi:</label>
                        <textarea id="editVisi"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Misi:</label>
                        <textarea id="editMisi"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Sejarah:</label>
                        <textarea id="editSejarah"></textarea>
                    </div>
                    <button class="btn" onclick="saveProfil()">üíæ Simpan Profil</button>
                </div>

                <!-- Tab Berita -->
                <div id="adminBeritaTab" class="tab-content">
                    <h3>Tambah Berita Baru</h3>
                    <div class="form-group">
                        <label>Judul Berita:</label>
                        <input type="text" id="newsTitle">
                    </div>
                    <div class="form-group">
                        <label>Tanggal:</label>
                        <input type="date" id="newsDate">
                    </div>
                    <div class="form-group">
                        <label>Isi Berita:</label>
                        <textarea id="newsContent"></textarea>
                    </div>
                    <button class="btn" onclick="addNews()">‚ûï Tambah Berita</button>
                    
                    <h3 style="margin-top: 30px;">Daftar Berita</h3>
                    <div id="adminNewsList"></div>
                </div>

                <!-- Tab Galeri -->
                <div id="adminGaleriTab" class="tab-content">
                    <h3>Upload Foto/Video</h3>
                    <div class="form-group">
                        <label>Judul:</label>
                        <input type="text" id="galleryTitle">
                    </div>
                    <div class="form-group">
                        <label>Deskripsi:</label>
                        <input type="text" id="galleryDesc">
                    </div>
                    <div class="form-group">
                        <label>File (Foto/Video - Max 5MB):</label>
                        <input type="file" id="galleryFile" accept="image/*,video/*">
                    </div>
                    <button class="btn" onclick="addGallery()">‚ûï Upload</button>
                    
                    <h3 style="margin-top: 30px;">Galeri Tersimpan</h3>
                    <div id="adminGalleryList"></div>
                </div>

                <!-- Tab Struktur -->
                <div id="adminStrukturTab" class="tab-content">
                    <h3>Tambah Anggota Organisasi</h3>
                    <div class="form-group">
                        <label>Nama:</label>
                        <input type="text" id="memberName">
                    </div>
                    <div class="form-group">
                        <label>Jabatan:</label>
                        <input type="text" id="memberPosition">
                    </div>
                    <div class="form-group">
                        <label>Keterangan:</label>
                        <textarea id="memberDesc"></textarea>
                    </div>
                    <button class="btn" onclick="addMember()">‚ûï Tambah Anggota</button>
                    
                    <h3 style="margin-top: 30px;">Daftar Anggota</h3>
                    <div id="adminMemberList"></div>
                </div>

                <!-- Tab Kontak -->
                <div id="adminKontakTab" class="tab-content">
                    <h3>Edit Informasi Kontak</h3>
                    <div class="form-group">
                        <label>Alamat:</label>
                        <textarea id="editAlamat"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Telepon:</label>
                        <input type="text" id="editTelepon">
                    </div>
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="editEmail">
                    </div>
                    <button class="btn" onclick="saveKontak()">üíæ Simpan Kontak</button>
                </div>

                <!-- Tab Security -->
                <div id="adminSecurityTab" class="tab-content">
                    <h3>üîí Pengaturan Keamanan</h3>
                    
                    <div class="alert alert-warning">
                        <strong>‚ö†Ô∏è Peringatan:</strong> Fitur ini untuk mengelola keamanan akun admin. Pastikan password yang kuat.
                    </div>

                    <div class="form-group">
                        <label>Ganti Password:</label>
                        <input type="password" id="newPassword" placeholder="Password baru (min. 8 karakter)">
                    </div>
                    <div class="form-group">
                        <label>Konfirmasi Password:</label>
                        <input type="password" id="confirmPassword" placeholder="Ulangi password baru">
                    </div>
                    <button class="btn" onclick="changePassword()">üîë Ubah Password</button>

                    <h3 style="margin-top: 30px;">üìä Log Aktivitas Admin</h3>
                    <div id="activityLog" style="max-height: 300px; overflow-y: auto;"></div>

                    <h3 style="margin-top: 30px;">üóëÔ∏è Hapus Semua Data</h3>
                    <div class="alert alert-error">
                        <strong>‚ö†Ô∏è Peringatan:</strong> Tindakan ini akan menghapus SEMUA data website dan tidak dapat dibatalkan!
                    </div>
                    <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Reset Website</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // KONFIGURASI KEAMANAN
        // ==========================================
        
        const SECURITY_CONFIG = {
            MAX_LOGIN_ATTEMPTS: 5,
            LOCKOUT_TIME: 15 * 60 * 1000, // 15 menit
            SESSION_TIMEOUT: 30 * 60 * 1000, // 30 menit
            MIN_PASSWORD_LENGTH: 8,
            MAX_FILE_SIZE: 5 * 1024 * 1024 // 5MB
        };

        // Hash password dengan SHA-256
        async function hashPassword(password) {
            const encoder = new TextEncoder();
            const data = encoder.encode(password);
            const hash = await crypto.subtle.digest('SHA-256', data);
            return Array.from(new Uint8Array(hash))
                .map(b => b.toString(16).padStart(2, '0'))
                .join('');
        }

        // Enkripsi data
        function encryptData(data) {
            try {
                return btoa(encodeURIComponent(JSON.stringify(data)));
            } catch (e) {
                console.error('Enkripsi gagal:', e);
                return null;
            }
        }

        // Dekripsi data
        function decryptData(encryptedData) {
            try {
                return JSON.parse(decodeURIComponent(atob(encryptedData)));
            } catch (e) {
                console.error('Dekripsi gagal:', e);
                return null;
            }
        }

        // Simpan data terenkripsi
        function saveEncrypted(key, data) {
            const encrypted = encryptData(data);
            if (encrypted) {
                localStorage.setItem(key, encrypted);
                return true;
            }
            return false;
        }

        // Ambil data terenkripsi
        function getEncrypted(key) {
            const encrypted = localStorage.getItem(key);
            if (encrypted) {
                return decryptData(encrypted);
            }
            return null;
        }

        // ==========================================
        // SISTEM AUTENTIKASI AMAN
        // ==========================================

        // Inisialisasi admin default (GANTI PASSWORD INI!)
        function initializeAdmin() {
            const adminData = getEncrypted('adminAccounts');
            if (!adminData) {
                // Hash password default
                hashPassword('JangkarMuda26').then(hash => {
                    const defaultAdmin = [{
                        email: 'admin@JangkarMuda26.com',
                        passwordHash: hash,
                        createdAt: new Date().toISOString()
                    }];
                    saveEncrypted('adminAccounts', defaultAdmin);
                });
            }
        }

        // Cek login attempts
        function checkLoginAttempts() {
            const attempts = getEncrypted('loginAttempts') || { count: 0, lastAttempt: null };
            
            if (attempts.count >= SECURITY_CONFIG.MAX_LOGIN_ATTEMPTS) {
                const lockoutEnd = new Date(attempts.lastAttempt).getTime() + SECURITY_CONFIG.LOCKOUT_TIME;
                const now = Date.now();
                
                if (now < lockoutEnd) {
                    const remainingMinutes = Math.ceil((lockoutEnd - now) / 60000);
                    return {
                        locked: true,
                        remainingMinutes
                    };
                } else {
                    // Reset attempts setelah lockout berakhir
                    saveEncrypted('loginAttempts', { count: 0, lastAttempt: null });
                }
            }
            
            return { locked: false };
        }

        // Tambah login attempt
        function addLoginAttempt() {
            const attempts = getEncrypted('loginAttempts') || { count: 0 };
            attempts.count++;
            attempts.lastAttempt = new Date().toISOString();
            saveEncrypted('loginAttempts', attempts);
            
            if (attempts.count >= SECURITY_CONFIG.MAX_LOGIN_ATTEMPTS - 2) {
                const warning = document.getElementById('loginAttemptWarning');
                warning.innerHTML = `<div class="attempt-counter">‚ö†Ô∏è Peringatan: ${SECURITY_CONFIG.MAX_LOGIN_ATTEMPTS - attempts.count} kesempatan tersisa!</div>`;
            }
        }

        // Reset login attempts
        function resetLoginAttempts() {
            saveEncrypted('loginAttempts', { count: 0, lastAttempt: null });
            document.getElementById('loginAttemptWarning').innerHTML = '';
        }

        // Login admin
        async function loginAdmin() {
            // Cek lockout
            const lockoutStatus = checkLoginAttempts();
            if (lockoutStatus.locked) {
                showAlert(`Akun terkunci! Coba lagi dalam ${lockoutStatus.remainingMinutes} menit.`, 'error');
                document.getElementById('loginBtn').disabled = true;
                return;
            }

            const email = document.getElementById('adminEmail').value.trim();
            const password = document.getElementById('adminPassword').value;

            if (!email || !password) {
                showAlert('Mohon isi email dan password!', 'error');
                return;
            }

            const adminAccounts = getEncrypted('adminAccounts') || [];
            const passwordHash = await hashPassword(password);
            
            const admin = adminAccounts.find(acc => acc.email === email && acc.passwordHash === passwordHash);

            if (admin) {
                // Login berhasil
                const sessionData = {
                    email: email,
                    loginTime: new Date().toISOString(),
                    sessionId: generateSessionId()
                };
                
                saveEncrypted('adminSession', sessionData);
                resetLoginAttempts();
                logActivity('Login berhasil', email);
                
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('loggedEmail').textContent = email;
                
                startSessionMonitoring();
                loadAdminData();
                showAlert('Login berhasil!', 'success');
            } else {
                // Login gagal
                addLoginAttempt();
                logActivity('Login gagal - kredensial salah', email);
                showAlert('Email atau password salah!', 'error');
            }
        }

        // Generate session ID
        function generateSessionId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        // Session monitoring
        let sessionTimer = null;
        let activityTimer = null;

        function startSessionMonitoring() {
            updateSessionInfo();
            
            // Auto logout setelah timeout
            sessionTimer = setTimeout(() => {
                showAlert('Sesi berakhir. Silakan login kembali.', 'warning');
                logoutAdmin();
            }, SECURITY_CONFIG.SESSION_TIMEOUT);

            // Update session info setiap menit
            activityTimer = setInterval(updateSessionInfo, 60000);
        }

        function updateSessionInfo() {
            const session = getEncrypted('adminSession');
            if (session) {
                const loginTime = new Date(session.loginTime);
                const now = new Date();
                const duration = Math.floor((now - loginTime) / 60000);
                const remaining = Math.floor(SECURITY_CONFIG.SESSION_TIMEOUT / 60000) - duration;
                
                document.getElementById('sessionInfo').innerHTML = `
                    ‚è±Ô∏è Sesi aktif: ${duration} menit | Auto-logout dalam: ${remaining} menit
                `;
            }
        }

        function checkAdminAuth() {
            const session = getEncrypted('adminSession');
            const loginSection = document.getElementById('loginSection');
            const adminPanel = document.getElementById('adminPanel');

            if (session) {
                const loginTime = new Date(session.loginTime).getTime();
                const now = Date.now();
                
                if (now - loginTime < SECURITY_CONFIG.SESSION_TIMEOUT) {
                    loginSection.style.display = 'none';
                    adminPanel.style.display = 'block';
                    document.getElementById('loggedEmail').textContent = session.email;
                    startSessionMonitoring();
                    loadAdminData();
                } else {
                    logoutAdmin();
                    showAlert('Sesi telah berakhir. Silakan login kembali.', 'warning');
                }
            } else {
                loginSection.style.display = 'block';
                adminPanel.style.display = 'none';
            }
        }

        function logoutAdmin() {
            const session = getEncrypted('adminSession');
            if (session) {
                logActivity('Logout', session.email);
            }
            
            localStorage.removeItem('adminSession');
            clearTimeout(sessionTimer);
            clearInterval(activityTimer);
            
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('adminEmail').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('loginBtn').disabled = false;
            
            showAlert('Logout berhasil!', 'success');
        }

        // Ganti password
        async function changePassword() {
            const newPass = document.getElementById('newPassword').value;
            const confirmPass = document.getElementById('confirmPassword').value;
            const session = getEncrypted('adminSession');

            if (!newPass || !confirmPass) {
                showAlert('Mohon isi semua field!', 'error');
                return;
            }

            if (newPass.length < SECURITY_CONFIG.MIN_PASSWORD_LENGTH) {
                showAlert(`Password minimal ${SECURITY_CONFIG.MIN_PASSWORD_LENGTH} karakter!`, 'error');
                return;
            }

            if (newPass !== confirmPass) {
                showAlert('Password tidak cocok!', 'error');
                return;
            }

            const adminAccounts = getEncrypted('adminAccounts') || [];
            const adminIndex = adminAccounts.findIndex(acc => acc.email === session.email);

            if (adminIndex !== -1) {
                const newHash = await hashPassword(newPass);
                adminAccounts[adminIndex].passwordHash = newHash;
                adminAccounts[adminIndex].updatedAt = new Date().toISOString();
                
                saveEncrypted('adminAccounts', adminAccounts);
                logActivity('Password diubah', session.email);
                
                document.getElementById('newPassword').value = '';
                document.getElementById('confirmPassword').value = '';
                
                showAlert('Password berhasil diubah!', 'success');
            }
        }

        // Log aktivitas
        function logActivity(action, user) {
            const logs = getEncrypted('activityLogs') || [];
            logs.unshift({
                timestamp: new Date().toISOString(),
                action,
                user,
                ip: 'localhost' // Dalam produksi, bisa ambil dari server
            });
            
            // Simpan maksimal 100 log terakhir
            if (logs.length > 100) {
                logs.pop();
            }
            
            saveEncrypted('activityLogs', logs);
            loadActivityLogs();
        }

        function loadActivityLogs() {
            const logs = getEncrypted('activityLogs') || [];
            const container = document.getElementById('activityLog');
            
            if (logs.length === 0) {
                container.innerHTML = '<p style="color: #999;">Belum ada aktivitas</p>';
                return;
            }

            container.innerHTML = logs.slice(0, 20).map(log => `
                <div class="news-item" style="margin-bottom: 10px;">
                    <strong>${formatDateTime(log.timestamp)}</strong><br>
                    ${log.action} - ${log.user}
                </div>
            `).join('');
        }

        // ==========================================
        // FUNGSI MODAL & TABS
        // ==========================================

        function openAdmin() {
            document.getElementById('adminModal').classList.add('active');
            checkAdminAuth();
        }

        function closeAdmin() {
            document.getElementById('adminModal').classList.remove('active');
        }

        function switchAdminTab(tab) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(t => t.classList.remove('active'));
            contents.forEach(c => c.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById('admin' + tab.charAt(0).toUpperCase() + tab.slice(1) + 'Tab').classList.add('active');
            
            if (tab === 'security') {
                loadActivityLogs();
            }
        }

        // ==========================================
        // CONTENT MANAGEMENT (sama seperti sebelumnya tapi dengan enkripsi)
        // ==========================================

        function loadAdminData() {
            const profil = getEncrypted('websiteProfil') || {};
            document.getElementById('editHeroTitle').value = profil.title || '';
            document.getElementById('editHeroSubtitle').value = profil.subtitle || '';
            document.getElementById('editVisi').value = profil.visi || '';
            document.getElementById('editMisi').value = profil.misi || '';
            document.getElementById('editSejarah').value = profil.sejarah || '';

            const kontak = getEncrypted('websiteKontak') || {};
            document.getElementById('editAlamat').value = kontak.alamat || '';
            document.getElementById('editTelepon').value = kontak.telepon || '';
            document.getElementById('editEmail').value = kontak.email || '';

            loadAdminNewslist();
            loadAdminGalleryList();
            loadAdminMemberList();
        }

        function saveProfil() {
            const profil = {
                title: document.getElementById('editHeroTitle').value,
                subtitle: document.getElementById('editHeroSubtitle').value,
                visi: document.getElementById('editVisi').value,
                misi: document.getElementById('editMisi').value,
                sejarah: document.getElementById('editSejarah').value
            };

            saveEncrypted('websiteProfil', profil);
            updateProfilDisplay();
            logActivity('Profil diupdate', getEncrypted('adminSession').email);
            showAlert('Profil berhasil disimpan!', 'success');
        }

        function updateProfilDisplay() {
            const profil = getEncrypted('websiteProfil') || {};
            if (profil.title) document.getElementById('heroTitle').textContent = profil.title;
            if (profil.subtitle) document.getElementById('heroSubtitle').textContent = profil.subtitle;
            if (profil.visi) document.getElementById('visiContent').textContent = profil.visi;
            if (profil.misi) document.getElementById('misiContent').innerHTML = profil.misi.replace(/\n/g, '<br>');
            if (profil.sejarah) document.getElementById('sejarahContent').textContent = profil.sejarah;
        }

        // News Management
        function addNews() {
            const title = document.getElementById('newsTitle').value;
            const date = document.getElementById('newsDate').value;
            const content = document.getElementById('newsContent').value;

            if (!title || !date || !content) {
                showAlert('Mohon lengkapi semua field!', 'error');
                return;
            }

            const news = {
                id: Date.now(),
                title,
                date,
                content,
                author: getEncrypted('adminSession').email
            };

            const newsList = getEncrypted('newsList') || [];
            newsList.unshift(news);
            saveEncrypted('newsList', newsList);

            updateNewsDisplay();
            loadAdminNewslist();
            logActivity('Berita ditambahkan: ' + title, getEncrypted('adminSession').email);
            
            document.getElementById('newsTitle').value = '';
            document.getElementById('newsDate').value = '';
            document.getElementById('newsContent').value = '';
            
            showAlert('Berita berhasil ditambahkan!', 'success');
        }

        function updateNewsDisplay() {
            const newsList = getEncrypted('newsList') || [];
            const container = document.getElementById('newsList');
            
            if (newsList.length === 0) {
                container.innerHTML = '<div class="news-item"><h3>Belum ada berita</h3><p>Silakan tambahkan berita dari panel admin</p></div>';
                return;
            }

            container.innerHTML = newsList.map(news => `
                <div class="news-item">
                    <h3>${escapeHtml(news.title)}</h3>
                    <div class="news-date">${formatDate(news.date)}</div>
                    <p>${escapeHtml(news.content)}</p>
                </div>
            `).join('');
        }

        function loadAdminNewslist() {
            const newsList = getEncrypted('newsList') || [];
            const container = document.getElementById('adminNewsList');
            
            container.innerHTML = newsList.map(news => `
                <div class="news-item">
                    <h3>${escapeHtml(news.title)}</h3>
                    <div class="news-date">${formatDate(news.date)}</div>
                    <p>${escapeHtml(news.content)}</p>
                    <button class="btn btn-danger btn-small" onclick="deleteNews(${news.id})">üóëÔ∏è Hapus</button>
                </div>
            `).join('');
        }

        function deleteNews(id) {
            if (confirm('Yakin ingin menghapus berita ini?')) {
                let newsList = getEncrypted('newsList') || [];
                newsList = newsList.filter(news => news.id !== id);
                saveEncrypted('newsList', newsList);
                updateNewsDisplay();
                loadAdminNewslist();
                logActivity('Berita dihapus', getEncrypted('adminSession').email);
                showAlert('Berita berhasil dihapus!', 'success');
            }
        }

        // Gallery Management dengan validasi ukuran file
        function addGallery() {
            const title = document.getElementById('galleryTitle').value;
            const desc = document.getElementById('galleryDesc').value;
            const file = document.getElementById('galleryFile').files[0];

            if (!title || !file) {
                showAlert('Mohon isi judul dan pilih file!', 'error');
                return;
            }

            // Validasi ukuran file
            if (file.size > SECURITY_CONFIG.MAX_FILE_SIZE) {
                showAlert('Ukuran file terlalu besar! Maksimal 5MB', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const gallery = {
                    id: Date.now(),
                    title,
                    desc,
                    type: file.type,
                    data: e.target.result,
                    uploadedBy: getEncrypted('adminSession').email,
                    uploadedAt: new Date().toISOString()
                };

                const galleryList = getEncrypted('galleryList') || [];
                galleryList.unshift(gallery);
                saveEncrypted('galleryList', galleryList);

                updateGalleryDisplay();
                loadAdminGalleryList();
                logActivity('File diupload: ' + title, getEncrypted('adminSession').email);
                
                document.getElementById('galleryTitle').value = '';
                document.getElementById('galleryDesc').value = '';
                document.getElementById('galleryFile').value = '';
                
                showAlert('File berhasil diupload!', 'success');
            };

            reader.readAsDataURL(file);
        }

        function updateGalleryDisplay() {
            const galleryList = getEncrypted('galleryList') || [];
            const container = document.getElementById('galleryGrid');
            
            if (galleryList.length === 0) {
                container.innerHTML = '<div class="gallery-item"><div class="file-preview"><div class="file-icon">üì∑</div><div>Belum ada galeri</div></div></div>';
                return;
            }

            container.innerHTML = galleryList.map(item => {
                let preview = '';
                if (item.type.startsWith('image/')) {
                    preview = `<img src="${item.data}" alt="${escapeHtml(item.title)}">`;
                } else if (item.type.startsWith('video/')) {
                    preview = `<video src="${item.data}" controls></video>`;
                }

                return `
                    <div class="gallery-item">
                        ${preview}
                        <div class="gallery-info">
                            <h4>${escapeHtml(item.title)}</h4>
                            <p>${escapeHtml(item.desc || 'Tidak ada deskripsi')}</p>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadAdminGalleryList() {
            const galleryList = getEncrypted('galleryList') || [];
            const container = document.getElementById('adminGalleryList');
            
            container.innerHTML = galleryList.map(item => `
                <div class="news-item">
                    <h3>${escapeHtml(item.title)}</h3>
                    <p>${escapeHtml(item.desc || 'Tidak ada deskripsi')}</p>
                    <p style="font-size: 0.9rem; color: #999;">Upload: ${formatDateTime(item.uploadedAt)}</p>
                    <button class="btn btn-danger btn-small" onclick="deleteGallery(${item.id})">üóëÔ∏è Hapus</button>
                </div>
            `).join('');
        }

        function deleteGallery(id) {
            if (confirm('Yakin ingin menghapus file ini?')) {
                let galleryList = getEncrypted('galleryList') || [];
                galleryList = galleryList.filter(item => item.id !== id);
                saveEncrypted('galleryList', galleryList);
                updateGalleryDisplay();
                loadAdminGalleryList();
                logActivity('File dihapus', getEncrypted('adminSession').email);
                showAlert('File berhasil dihapus!', 'success');
            }
        }

        // Member Management
        function addMember() {
            const name = document.getElementById('memberName').value;
            const position = document.getElementById('memberPosition').value;
            const desc = document.getElementById('memberDesc').value;

            if (!name || !position) {
                showAlert('Mohon isi nama dan jabatan!', 'error');
                return;
            }

            const member = {
                id: Date.now(),
                name,
                position,
                desc
            };

            const memberList = getEncrypted('memberList') || [];
            memberList.push(member);
            saveEncrypted('memberList', memberList);

            updateMemberDisplay();
            loadAdminMemberList();
            logActivity('Anggota ditambahkan: ' + name, getEncrypted('adminSession').email);
            
            document.getElementById('memberName').value = '';
            document.getElementById('memberPosition').value = '';
            document.getElementById('memberDesc').value = '';
            
            showAlert('Anggota berhasil ditambahkan!', 'success');
        }

        function updateMemberDisplay() {
            const memberList = getEncrypted('memberList') || [];
            const container = document.getElementById('structureGrid');
            
            if (memberList.length === 0) {
                container.innerHTML = '<div class="member-card"><div class="member-photo">üë§</div><h4>Belum ada data</h4><div class="member-position">-</div></div>';
                return;
            }

            container.innerHTML = memberList.map(member => `
                <div class="member-card">
                    <div class="member-photo">üë§</div>
                    <h4>${escapeHtml(member.name)}</h4>
                    <div class="member-position">${escapeHtml(member.position)}</div>
                    <p>${escapeHtml(member.desc || '')}</p>
                </div>
            `).join('');
        }

        function loadAdminMemberList() {
            const memberList = getEncrypted('memberList') || [];
            const container = document.getElementById('adminMemberList');
            
            container.innerHTML = memberList.map(member => `
                <div class="news-item">
                    <h3>${escapeHtml(member.name)}</h3>
                    <div class="member-position">${escapeHtml(member.position)}</div>
                    <p>${escapeHtml(member.desc || '')}</p>
                    <button class="btn btn-danger btn-small" onclick="deleteMember(${member.id})">üóëÔ∏è Hapus</button>
                </div>
            `).join('');
        }

        function deleteMember(id) {
            if (confirm('Yakin ingin menghapus anggota ini?')) {
                let memberList = getEncrypted('memberList') || [];
                memberList = memberList.filter(member => member.id !== id);
                saveEncrypted('memberList', memberList);
                updateMemberDisplay();
                loadAdminMemberList();
                logActivity('Anggota dihapus', getEncrypted('adminSession').email);
                showAlert('Anggota berhasil dihapus!', 'success');
            }
        }

        function saveKontak() {
            const kontak = {
                alamat: document.getElementById('editAlamat').value,
                telepon: document.getElementById('editTelepon').value,
                email: document.getElementById('editEmail').value
            };

            saveEncrypted('websiteKontak', kontak);
            updateKontakDisplay();
            logActivity('Kontak diupdate', getEncrypted('adminSession').email);
            showAlert('Kontak berhasil disimpan!', 'success');
        }

        function updateKontakDisplay() {
            const kontak = getEncrypted('websiteKontak') || {};
            if (kontak.alamat) document.getElementById('alamatContent').textContent = kontak.alamat;
            if (kontak.telepon) document.getElementById('teleponContent').textContent = kontak.telepon;
            if (kontak.email) document.getElementById('emailContent').textContent = kontak.email;
        }

        // Reset semua data
        function clearAllData() {
            const confirmText = 'HAPUS SEMUA';
            const userInput = prompt(`Ketik "${confirmText}" untuk menghapus semua data website:`);
            
            if (userInput === confirmText) {
                logActivity('Reset website - semua data dihapus', getEncrypted('adminSession').email);
                
                localStorage.clear();
                initializeAdmin();
                
                showAlert('Semua data berhasil dihapus! Website direset.', 'success');
                
                setTimeout(() => {
                    location.reload();
                }, 2000);
            } else {
                showAlert('Reset dibatalkan', 'warning');
            }
        }

        // ==========================================
        // UTILITY FUNCTIONS
        // ==========================================

        function showAlert(message, type) {
            const alertBox = document.getElementById('alertBox');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alertBox.appendChild(alert);

            setTimeout(() => alert.remove(), 3000);
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('id-ID', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function formatDateTime(isoStr) {
            const date = new Date(isoStr);
            return date.toLocaleString('id-ID');
        }

        // Escape HTML untuk prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // ==========================================
        // INITIALIZATION
        // ==========================================

        initializeAdmin();
        updateProfilDisplay();
        updateNewsDisplay();
        updateGalleryDisplay();
        updateMemberDisplay();
        updateKontakDisplay();

        // Tutup modal saat klik di luar
        window.onclick = function(event) {
            const modal = document.getElementById('adminModal');
            if (event.target === modal) {
                closeAdmin();
            }
        }
    </script>
</body>
</html>
